<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Course: The Book Launch Blueprint</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        /* Custom font import for Inter */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7fafc; /* Light gray background */
        }
        /* Custom styling for the horizontal navigation bar progress indicator */
        .active-lesson {
            position: relative;
            z-index: 10;
        }
        .active-lesson::after {
            content: '';
            position: absolute;
            bottom: -8px; /* Position below the text */
            left: 0;
            width: 100%;
            height: 4px; /* Thickness of the bar */
            background-color: #f59e0b; /* Amber-500 */
            border-radius: 9999px;
        }
        /* Styling for content area (prose wrapper) */
        #lesson-content-area h2 {
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
            font-size: 1.5rem; /* text-2xl */
            font-weight: 700; /* font-bold */
            color: #3730a3; /* indigo-800 */
        }
        #lesson-content-area h3 {
            margin-top: 1.5rem;
            margin-bottom: 0.5rem;
            font-size: 1.25rem; /* text-xl */
            font-weight: 700; /* font-bold */
            color: #4338ca; /* indigo-700 */
        }
        #lesson-content-area ul {
            list-style-type: disc;
            padding-left: 1.5rem;
            margin-top: 0.5rem;
        }
        #lesson-content-area li {
            margin-bottom: 0.5rem;
        }
    </style>
</head>
<body class="text-gray-800 min-h-screen flex flex-col">

    <!-- Header & Navigation - Using Indigo Theme -->
    <header class="bg-indigo-900 shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3 flex justify-between items-center">
            <!-- Logo/Home Link -->
            <a href="index.html" class="flex items-center space-x-2 text-xl font-extrabold text-white tracking-tight">
                <img src="lhtdhublogo.jpg" alt="lhtdhub Logo" class="h-8 w-8 rounded-full shadow-md" onerror="this.onerror=null; this.src='https://placehold.co/32x32/4f46e5/ffffff?text=ASC';">
                <span>Publishing Course Dashboard</span>
            </a>
            
            <!-- NEW: Module Selector Dropdown (Top Right) -->
            <div class="relative">
                <!-- Trigger Button -->
                <button id="module-selector-btn" class="flex items-center space-x-2 text-sm font-bold bg-amber-500 text-indigo-900 px-3 py-2 rounded-lg hover:bg-amber-400 transition duration-150 shadow-md">
                    <span id="header-current-lesson-title" class="truncate max-w-[150px] sm:max-w-none">Jump to Lesson...</span>
                    <!-- Icon: Chevron Down -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down"><path d="m6 9 6 6 6-6"/></svg>
                </button>

                <!-- Dropdown Menu -->
                <div id="header-module-dropdown" class="absolute right-0 mt-2 w-72 bg-white rounded-xl shadow-2xl z-50 border border-gray-100 hidden origin-top-right transform scale-95 transition-transform duration-200">
                    <div class="p-4">
                        <h3 class="text-base font-extrabold text-indigo-900 mb-2 border-b pb-1">Course Content</h3>
                        <div id="dropdown-lesson-list" class="max-h-80 overflow-y-auto space-y-3">
                            <!-- Lessons injected here by JS -->
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </header>

    <!-- Main Content: Course Modules and Lesson Content -->
    <main class="flex-grow max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 lg:py-12">
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">

            <!-- Column 1: Module Navigation (Sidebar) - Indigo Themed -->
            <aside class="lg:col-span-1 bg-white p-6 rounded-2xl shadow-xl border border-gray-100 h-fit lg:sticky lg:top-[70px]">
                <h2 class="text-2xl font-extrabold text-indigo-900 mb-4 border-b pb-2">Course Modules</h2>
                <nav id="module-nav" class="space-y-2">

                    <!-- Module 1: Production, Editing, and Cover Design -->
                    <div class="group">
                        <h3 class="flex items-center justify-between text-lg font-bold text-indigo-800 p-2">
                            <span>1. Setup & Metadata Mastery</span>
                        </h3>
                        <ul class="ml-4 border-l pl-4 border-gray-200 text-gray-600 space-y-1 text-sm" data-module="1">
                            <li class="p-2 rounded-lg cursor-pointer hover:bg-indigo-100 transition duration-150" data-lesson-index="0">1.1 Welcome & Publishing Checklist</li>
                            <li class="p-2 rounded-lg cursor-pointer hover:bg-indigo-100 transition duration-150" data-lesson-index="1">1.2 KDP vs. IngramSpark: Distribution Strategy</li>
                            <li class="p-2 rounded-lg cursor-pointer hover:bg-indigo-100 transition duration-150" data-lesson-index="2">1.3 Mastering Book Metadata (Keywords & Categories)</li>
                        </ul>
                    </div>

                    <!-- Module 2: Strategic Publishing & Platform Distribution -->
                    <div class="group pt-2">
                        <h3 class="flex items-center justify-between text-lg font-bold text-indigo-800 p-2">
                            <span>2. Professional Production & Design</span>
                        </h3>
                        <ul class="ml-4 border-l pl-4 border-gray-200 text-gray-600 space-y-1 text-sm" data-module="2">
                            <li class="p-2 rounded-lg cursor-pointer hover:bg-indigo-100 transition duration-150" data-lesson-index="3">2.1 Hiring & Managing Your Editor</li>
                            <li class="p-2 rounded-lg cursor-pointer hover:bg-indigo-100 transition duration-150" data-lesson-index="4">2.2 Cover Design That Sells</li>
                            <li class="p-2 rounded-lg cursor-pointer hover:bg-indigo-100 transition duration-150" data-lesson-index="5">2.3 Interior Formatting for Ebook & Print</li>
                        </ul>
                    </div>
                    
                    <!-- Module 3: The 90-Day Author Marketing Launch (NOW UNLOCKED) -->
                    <div class="group pt-2">
                        <h3 class="flex items-center justify-between text-lg font-bold text-indigo-800 p-2">
                            <span>3. The 90-Day Author Marketing Launch</span>
                        </h3>
                        <ul class="ml-4 border-l pl-4 border-gray-200 text-gray-600 space-y-1 text-sm" data-module="3">
                            <li class="p-2 rounded-lg cursor-pointer hover:bg-indigo-100 transition duration-150" data-lesson-index="6">3.1 Advanced Ad Strategy</li>
                            <li class="p-2 rounded-lg cursor-pointer hover:bg-indigo-100 transition duration-150" data-lesson-index="7">3.2 Reviewer Outreach & ARC Management</li>
                        </ul>
                    </div>
                </nav>
            </aside>

            <!-- Column 2: Lesson Content Area -->
            <section class="lg:col-span-3">

                <!-- Horizontal Lesson Navigation Bar (Top Right Section) -->
                <!-- Hidden on mobile, sticky on desktop for context -->
                <div id="horizontal-nav-bar" class="bg-indigo-900 py-4 px-6 rounded-t-2xl shadow-xl hidden lg:block sticky top-[70px] z-40">
                    <!-- Lesson titles will be generated here -->
                </div>
                
                <div class="bg-white p-6 md:p-8 rounded-2xl shadow-2xl lg:rounded-t-none">
                    <h1 id="lesson-title" class="text-3xl sm:text-4xl font-extrabold text-indigo-900 mb-2">
                        Loading Lesson...
                    </h1>
                    <p id="lesson-subtitle" class="text-amber-600 font-bold uppercase tracking-widest mb-6">
                        The Book Launch Blueprint
                    </p>

                    <!-- Lesson Description and Checklist (Starts immediately after subtitle) -->
                    <div id="lesson-content-area" class="prose max-w-none text-gray-700 mt-4">
                        <!-- Content will be injected here -->
                    </div>
                </div>

                <!-- Navigation Buttons (for mobile and explicit action) -->
                <div class="flex justify-between mt-8">
                    <!-- Previous Lesson Button -->
                    <button id="prev-button" class="flex items-center space-x-2 text-indigo-900 font-extrabold px-6 py-3 rounded-xl hover:bg-indigo-100 transition duration-300 shadow-md border border-indigo-200 disabled:bg-gray-100 disabled:text-gray-400 disabled:cursor-not-allowed">
                        <!-- Icon: Chevron Left -->
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-left"><path d="m15 18-6-6 6-6"/></svg>
                        <span>Previous Lesson</span>
                    </button>
                    
                    <!-- Next Lesson Button -->
                    <button id="next-button" class="flex items-center space-x-2 bg-amber-500 text-indigo-900 font-extrabold px-6 py-3 rounded-xl hover:bg-amber-400 transition duration-300 shadow-lg disabled:bg-gray-300 disabled:text-gray-500 disabled:cursor-not-allowed">
                        <span>Next Lesson</span>
                        <!-- Icon: Chevron Right -->
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right"><path d="m9 18 6-6-6-6"/></svg>
                    </button>
                </div>

            </section>
        </div>
    </main>

    <!-- Footer - Dark Indigo base for consistency -->
    <footer class="bg-indigo-900 text-white py-8 mt-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <p class="text-sm mb-4">© 2025 Author Success Hub. All course content is for student use only.</p>
        </div>
    </footer>

</body>
<script>
    // --- Course Data (All Unlocked) ---
    const courseData = [
        // Module 1: Setup & Metadata Mastery
        { module: 1, lesson: 1, title: "Welcome & Publishing Checklist", subtitle: "The Foundation", videoId: null, 
          content: "Welcome to the **Book Launch Blueprint**! This foundational lesson establishes the five critical phases of the self-publishing journey: **Writing**, **Editing/Production**, **Formatting**, **Distribution/Setup**, and **Launch/Marketing**. We emphasize the importance of adopting an **author-entrepreneur mindset**, treating your book as a business product from day one. Understanding these phases allows you to sequence tasks efficiently, hire the right professionals at the right time, and avoid costly delays. This meticulous preparation is the cornerstone of a successful, stress-free book launch, ensuring all legal and technical prerequisites are handled well before your promotional campaigns begin.",
          checklist: [
            "Manuscript Finalization: Completed developmental, copy, and proofreading edits.", 
            "Legal & Financial: Set up a dedicated bank account and business entity (e.g., LLC) for publishing.", 
            "ISBN Management: Purchased blocks of ISBNs (if using IngramSpark) or recorded the free KDP/IngramSpark provided ISBNs.", 
            "Copyright Registration: Completed copyright registration with the appropriate governmental agency.", 
            "Cover Design Files: Received high-resolution, print-ready (CMYK) and ebook (RGB) files.", 
            "Author Bio & Headshot: Wrote an engaging, genre-appropriate professional biography and secured a high-quality headshot.", 
            "Book Description: Finalized the compelling, keyword-rich blurb for all sales pages and back cover.",
            "Retail Accounts: Created and verified accounts for KDP and IngramSpark."
          ], 
          nextSteps: "Your next step is the crucial decision on how and where to sell your book globally. Click on **1.2 KDP vs. IngramSpark: Distribution Strategy** in the left sidebar to determine your optimal path to market."
        },
        { module: 1, lesson: 2, title: "KDP vs. IngramSpark: Distribution Strategy", subtitle: "The Distribution Crossroads", videoId: null, 
          content: "Choosing your primary distribution platform determines your reach, profitability, and marketing options. This lesson conducts a detailed comparison between **Amazon KDP (Kindle Direct Publishing)** and **IngramSpark**. KDP offers ease, higher royalty options (70%) for ebooks, and integration with Kindle Unlimited (**KU**), which requires **exclusive** distribution to Amazon for 90 days. IngramSpark, conversely, is the gateway to **global wide distribution**, reaching major bookstore chains (Barnes & Noble), libraries, and international markets, but it typically requires setting a 55% retailer discount, which impacts your profit margin. The decision often hinges on whether your priority is maximizing Amazon revenue (KU exclusivity) or securing broad retail and library access (IngramSpark). You must understand the royalty implications, the cost of print setup, and the control over metadata for each platform.",
          checklist: [
            "KDP Royalty Confirmation: Determined if your ebook meets the price and size requirements for the 70% royalty tier.", 
            "Kindle Unlimited Decision: Decided whether to enroll in Kindle Unlimited (KDP exclusivity) for the first 90 days.", 
            "IngramSpark Setup Costs: Identified current setup fees for IngramSpark (e.g., print and ebook upload fees, if applicable).",
            "Print Strategy: Compared KDP Print's distribution reach (mostly Amazon) versus IngramSpark's broader wholesale channel.", 
            "ISBN Assignment: Assigned a unique ISBN (purchased by you) to the IngramSpark version, or used KDP's free ISBN for that platform."
          ],
          nextSteps: "Now that you've chosen your distribution path, proceed to lesson **1.3** where we break down the most powerful way to optimize your book's discovery: **Mastering Book Metadata**."
        },
        { module: 1, lesson: 3, title: "Mastering Book Metadata (Keywords & Categories)", subtitle: "The Discovery Engine", videoId: null, 
          content: "Metadata is the invisible architecture that drives book discovery. This lesson dives deep into keyword research and category selection to ensure your book is found by its target audience. **Keywords** are not just for searching; they inform Amazon's advertising algorithms and suggest related books. You must leverage the **seven KDP keyword slots** by using long-tail phrases (3-5 words) that capture reader intent, rather than single, broad words. Furthermore, we cover the strategic importance of using **BISAC codes** for IngramSpark and the technique for hitting all **ten available Amazon categories** (by contacting KDP support), rather than the two standard slots, maximizing your visibility in specialized niches. This strategic manipulation of metadata is essential for achieving bestseller status in smaller, more achievable categories.",
          checklist: [
            "Keyword Research Tool: Subscribed to or utilized a market research tool (e.g., KDP Rocket, Publisher Rocket) to identify highly relevant, low-competition keywords.", 
            "KDP Keyword Slots: Optimized all seven KDP slots using long-tail phrases and including keywords that describe mood, setting, and plot devices.", 
            "Category Selection: Identified at least ten relevant Amazon categories (including sub-categories) for maximum visibility.",
            "BISAC Code Mapping: Mapped your chosen categories to the appropriate BISAC codes required by IngramSpark.", 
            "Competitor Analysis: Analyzed the top three bestselling books in your core categories to determine their primary keywords and category placement."
          ],
          nextSteps: "Metadata is handled! Now it's time to professionalize your product. Continue to lesson **2.1** to learn the strategic process of **Hiring & Managing Your Editor**."
        },
        // Module 2: Professional Production & Design
        { module: 2, lesson: 1, title: "Hiring & Managing Your Editor", subtitle: "Production Phase Begins", videoId: null, 
          content: "A professional editor is the single most important investment you will make in your book. This lesson demystifies the different types of editing: **Developmental Editing** (focuses on plot, character, and pacing), **Copyediting** (focuses on grammar, syntax, and consistency), and **Proofreading** (the final check for typos and minor errors). We provide a clear framework for vetting candidates, including requesting a **test edit** of 1,000-2,000 words to assess fit and quality. Crucially, you will learn how to draft a comprehensive **Statement of Work (SOW)**. The SOW must explicitly define the scope of work (which type of editing), the file format (e.g., Word with Track Changes), the number of revision rounds included, the total budget and payment schedule, and a clear conflict resolution clause, ensuring a smooth, professional collaboration that stays on budget and on deadline.",
          checklist: [
            "Editing Needs Assessment: Determined which type(s) of editing are required for your manuscript's current state.", 
            "Editor Vetting: Contacted a minimum of three potential editors and checked their references and portfolios.", 
            "Test Edit Request: Sent a 1,000-word sample to your top candidates and reviewed the results for clarity and style fit.", 
            "SOW Finalization: Drafted the Statement of Work detailing the scope, revision rounds, payment schedule, and final delivery dates.", 
            "Contract Signing: Executed the signed contract and initiated the payment schedule as agreed."
          ],
          nextSteps: "With your editor secured, the next crucial step is designing your book's face. Discover the secrets of cover design that commands attention and converts browsers in lesson **2.2**."
        },
        { module: 2, lesson: 2, title: "Cover Design That Sells", subtitle: "First Impressions Count: The 5-Second Rule", videoId: null, 
          content: "Your cover is not art; it is a **business tool** responsible for 80% of your book’s purchasing decision within five seconds. This lesson focuses on making your cover **marketable** and **genre-appropriate**. We delve into the **Five-Second Rule**: ensuring a potential buyer can instantly recognize the genre, the tone, and the quality of your book from a thumbnail image. This requires strict adherence to **genre conventions** (e.g., specific fonts for thrillers, color palettes for romance). We cover the essential technical requirements: ensuring the cover is 300 DPI for print, using the correct color space (CMYK for print, RGB for digital), and preparing the full wrap (front, spine, back) dimensions required by KDP and IngramSpark. Finally, we provide a template for creating a detailed design brief, ensuring your designer delivers a market-ready final product on the first try.",
          checklist: [
            "Genre Convention Analysis: Gathered and analyzed the top 10 bestselling covers in your specific sub-genre for visual queues (fonts, colors, imagery).", 
            "Design Brief Creation: Developed a brief including 3 visual mockups, target audience demographics, back cover copy, and technical specs.", 
            "Title Visibility Check: Ensured the title and author name are legible and impactful at thumbnail size (approx. 200px wide).", 
            "Technical Specs Confirmation: Verified designer's output is 300 DPI, CMYK for print, and adheres to the specific trim size and bleed requirements of your distributor.",
            "Cover Mockups: Created 3D mockups of the final cover for use in early marketing materials."
          ],
          nextSteps: "Your cover is ready. In lesson **2.3**, you'll learn the final professional step: perfecting the reading experience through **Interior Formatting** for both print and ebook."
        },
        { module: 2, lesson: 3, title: "Interior Formatting for Ebook & Print", subtitle: "Professional Polish", videoId: null, 
          content: "Proper interior formatting elevates your book from amateur project to professional product, ensuring a seamless reading experience across all devices. This lesson differentiates between **reflowable EPUB** files (essential for text-heavy ebooks to adapt to screen size) and fixed-layout files (used for graphic novels or cookbooks). For **print formatting**, we detail critical steps such as selecting the optimal trim size (e.g., 6x9 in non-fiction), correctly calculating the **gutter margin** (the inner margin near the spine), and ensuring that new chapters consistently start on an odd page for visual professionalism. We also review essential software tools like **Vellum** or **Atticus** for efficient formatting, covering best practices for handling special elements like front matter, copyright pages, and maintaining consistent styles throughout the text, including proper hyphenation and avoiding 'widows' or 'orphans' (single lines isolated at the top or bottom of pages).",
          checklist: [
            "Trim Size & Margin Settings: Finalized the trim size and ensured correct gutter and outside margins for print-on-demand.", 
            "Print-Ready PDF Generation: Generated the final print-ready PDF, checking that all fonts are embedded and the bleed is correct (typically 0.125 inches).", 
            "EPUB/MOBI Creation: Created a clean, reflowable EPUB file (or MOBI for older KDP requirements) free of unnecessary HTML tags.", 
            "Quality Control: Conducted a final check of both the print PDF and EPUB on multiple devices/previewers to ensure no formatting errors, including correct chapter breaks.",
            "Accessibility Check: Verified that the ebook includes proper heading structure for screen reader accessibility."
          ],
          nextSteps: "Congratulations! You have completed the Production module. Your book is physically ready to publish. Continue to lesson **3.1** to dive into the core of the launch: **Advanced Ad Strategy**."
        },
        // Module 3: The 90-Day Author Marketing Launch (UNLOCKED)
        { module: 3, lesson: 1, title: "Advanced Ad Strategy", subtitle: "Targeted Marketing: Maximizing ROAS", videoId: null, 
          content: "Moving beyond basic promotion, this lesson focuses on advanced **Amazon Ads (AMS)** and platform-specific marketing strategies designed to maximize your **Return on Ad Spend (ROAS)**. We break down the three primary campaign types you need to master on Amazon: **Sponsored Products** (Automatic and Manual campaigns targeting keywords), **Product Targeting** (targeting specific competitor books), and **Category Targeting** (broad visibility within a genre). The key metric is not just **ACoS** (Advertising Cost of Sales), but **TACOS** (Total ACoS), which measures ad spend against total book sales (both organic and paid). We introduce a strategic, rule-based approach to **scaling your budget**, showing you exactly when to increase bids and budgets for profitable campaigns and when to harvest high-performing keywords from your Automatic campaigns to migrate into Manual campaigns. This structured approach ensures continuous, profitable growth rather than sporadic sales spikes.",
          checklist: [
            "Campaign Structure: Established a minimum of five distinct AMS campaigns (Auto, Manual Keyword, Manual Product, Category, and Defensive).", 
            "A/B Testing: Set up A/B tests for three different ad creatives and blurb variations to optimize click-through rates (CTR).", 
            "Search Term Report Migration: Analyzed the Search Term Report from Auto campaigns weekly, harvesting high-converting keywords to add to Manual campaigns.",
            "Bid Optimization: Implemented a daily review process to increase bids by 5% on profitable keywords (ACoS < target) and decrease bids by 10% on underperforming ones.", 
            "ROAS/TACOS Tracking: Created a dedicated spreadsheet to track both ACoS and TACOS weekly to monitor overall campaign health."
          ], 
          nextSteps: "Ads bring traffic, but reviews drive conversion. Learn how to legally and ethically secure critical launch-day buzz in lesson **3.2**."
        },
        { module: 3, lesson: 2, title: "Reviewer Outreach & ARC Management", subtitle: "Building Buzz and Social Proof", videoId: null, 
          content: "Social proof, driven by early reviews, is essential for converting ad traffic into sales. This lesson provides a masterclass in legally and ethically managing an **Advance Reader Copy (ARC)** team, adhering strictly to Amazon's Terms of Service (TOS) regarding paid or solicited reviews. We review key platforms like **BookFunnel** for streamlined ebook delivery to ARC readers and **Booksprout** for managing reviewer pools. You will learn the art of professional outreach: crafting personalized emails to book bloggers, influencers, and niche reviewers. The goal is to secure a critical mass of 15-25 reviews within the first week of launch. We also detail the post-launch follow-up strategy, including creating a 'Reviewer Tracking Spreadsheet' to monitor who posted where and when, and sending a single, polite follow-up email one week after the book's release to gently remind readers to post their reviews.",
          checklist: [
            "ARC Recruitment: Created a dedicated landing page (using a tool like BookFunnel) and recruited 20-30 ARC readers via newsletter, social media, and Booksprout.", 
            "Reviewer Tracking: Developed a Reviewer Tracking Spreadsheet listing names, email addresses, delivery status, and a column for the date the review was posted.", 
            "Outreach List: Curated a personalized list of 10-15 book bloggers/reviewers in your niche for one-on-one outreach.", 
            "Review Request: Sent the first official review request email immediately upon release.",
            "Follow-up Scheduling: Pre-scheduled a polite, non-demanding follow-up email for one week post-launch to maximize review placement."
          ],
          nextSteps: "Course Complete! You now possess the comprehensive **Book Launch Blueprint**. It’s time to apply these strategies and launch your book with complete confidence. Good luck!"
        }
    ];

    let currentLessonIndex = 0; // Start at the first lesson

    // --- DOM Elements ---
    const lessonTitleEl = document.getElementById('lesson-title');
    const lessonSubtitleEl = document.getElementById('lesson-subtitle');
    const lessonContentAreaEl = document.getElementById('lesson-content-area');
    const prevButton = document.getElementById('prev-button');
    const nextButton = document.getElementById('next-button');
    const lessonListItems = document.querySelectorAll('[data-lesson-index]');
    const horizontalNavBar = document.getElementById('horizontal-nav-bar');
    
    // Header Dropdown Elements
    const moduleSelectorBtn = document.getElementById('module-selector-btn');
    const headerModuleDropdown = document.getElementById('header-module-dropdown');
    const headerCurrentLessonTitle = document.getElementById('header-current-lesson-title');
    const dropdownLessonList = document.getElementById('dropdown-lesson-list');

    // --- Helper Functions ---

    /**
     * Converts markdown-style bolding (**text**) to HTML <strong>text</strong>.
     * @param {string} text The input string containing markdown bolds.
     * @returns {string} The HTML string with bold tags.
     */
    function processMarkdownBolds(text) {
        if (!text) return '';
        // Replace **text** with <strong>text</strong> globally and non-greedily
        return text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
    }

    // Generates the content HTML structure (description, checklist, next steps)
    function generateContentHTML(lesson) {
        // Process markdown bolds for the main content and next steps
        const processedContent = processMarkdownBolds(lesson.content);
        const processedNextSteps = processMarkdownBolds(lesson.nextSteps);

        let html = `
            <h2 class="text-2xl font-bold text-indigo-800 mb-3">About This Lesson</h2>
            <p>${processedContent}</p>
        `;

        if (lesson.checklist && lesson.checklist.length > 0) {
            html += `
                <h3 class="text-xl font-bold text-indigo-700 mt-6">Publishing Readiness Checklist:</h3>
                <ul class="list-disc list-inside space-y-1 ml-4">
                    ${lesson.checklist.map(item => `<li><span class="font-semibold">${item.split(':')[0]}:</span> ${item.split(':')[1] || ''}</li>`).join('')}
                </ul>
            `;
        }

        html += `
            <h3 class="text-xl font-bold text-indigo-700 mt-6">Next Steps:</h3>
            <p>${processedNextSteps}</p>
        `;

        return html;
    }

    // Generates the horizontal navigation bar content
    function generateHorizontalNav() {
        const lessonsToShow = [];
        // Add up to 2 lessons before the current one
        for (let i = Math.max(0, currentLessonIndex - 2); i < currentLessonIndex; i++) {
            lessonsToShow.push({ ...courseData[i], index: i });
        }
        // Add the current lesson
        lessonsToShow.push({ ...courseData[currentLessonIndex], index: currentLessonIndex });
        // Add up to 2 lessons after the current one
        for (let i = currentLessonIndex + 1; i < Math.min(courseData.length, currentLessonIndex + 3); i++) {
            lessonsToShow.push({ ...courseData[i], index: i });
        }

        let navHTML = `<div class="flex space-x-6 overflow-x-auto whitespace-nowrap py-1 relative">`;

        lessonsToShow.forEach(item => {
            const isCurrent = item.index === currentLessonIndex;
            const classList = isCurrent 
                ? 'active-lesson text-amber-400 font-extrabold cursor-default' 
                : 'text-white/80 font-semibold cursor-pointer hover:text-amber-300 transition duration-150';
            
            // Abbreviated title: 1.1 Welcome
            const lessonLabel = `${item.module}.${item.lesson} ${item.title.split(':')[0].split('(')[0].trim()}`; 
            
            navHTML += `
                <span 
                    class="${classList}" 
                    data-lesson-index="${item.index}"
                    onclick="updateLesson(${item.index})"
                >
                    ${lessonLabel}
                </span>
            `;
        });

        navHTML += `</div>`;
        horizontalNavBar.innerHTML = navHTML;
    }

    // Generates the lesson links for the header dropdown
    function generateDropdownLessons() {
        let html = '';
        let currentModule = 0;

        courseData.forEach((lesson, index) => {
            if (lesson.module !== currentModule) {
                // Start new module section
                if (currentModule !== 0) {
                    html += `</div>`; // Close previous module group
                }
                // Get the module title from the first lesson in the module, truncate it
                let moduleTitle;
                if (lesson.module === 1) moduleTitle = "Setup & Metadata Mastery";
                else if (lesson.module === 2) moduleTitle = "Professional Production & Design";
                else if (lesson.module === 3) moduleTitle = "The 90-Day Author Marketing Launch";
                else moduleTitle = "Module " + lesson.module;

                html += `
                    <div class="pt-2">
                        <h4 class="text-sm font-bold text-indigo-800">${lesson.module}. ${moduleTitle.trim()}</h4>
                        <div class="space-y-1 pl-2 border-l border-gray-200">
                `;
                currentModule = lesson.module;
            }

            const isCurrent = index === currentLessonIndex;

            const classList = isCurrent
                ? 'font-bold text-amber-600 cursor-default flex items-center'
                : 'text-gray-700 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg p-1 transition duration-150 cursor-pointer flex items-center';
            
            const onclick = `onclick="updateLesson(${index}); toggleDropdown(false);"`;

            html += `
                <a ${onclick} class="${classList} text-sm">
                    ${lesson.module}.${lesson.lesson} ${lesson.title.split(':')[0].split('(')[0].trim()}
                </a>
            `;
        });
        
        // Close the last module group
        html += `</div></div>`;
        dropdownLessonList.innerHTML = html;
        lucide.createIcons();
    }

    // Toggles the visibility of the header dropdown
    function toggleDropdown(show) {
        if (typeof show === 'boolean') {
            headerModuleDropdown.classList.toggle('hidden', !show);
            headerModuleDropdown.classList.toggle('scale-100', show);
            headerModuleDropdown.classList.toggle('scale-95', !show);
        } else {
            headerModuleDropdown.classList.toggle('hidden');
            headerModuleDropdown.classList.toggle('scale-100');
            headerModuleDropdown.classList.toggle('scale-95');
        }
    }

    // --- Core Functionality ---

    window.updateLesson = function(newIndex) {
        if (newIndex < 0 || newIndex >= courseData.length) {
            console.error("Lesson index out of bounds:", newIndex);
            return;
        }

        currentLessonIndex = newIndex;
        const lesson = courseData[currentLessonIndex];

        // 1. Update Horizontal Navigation Bar
        generateHorizontalNav();
        
        // 2. Regenerate Dropdown to update current lesson highlight
        generateDropdownLessons();

        // 3. Update Header Button Text
        headerCurrentLessonTitle.textContent = `${lesson.module}.${lesson.lesson} ${lesson.title.split(':')[0].split('(')[0].trim()}`;

        // 4. Update Sidebar Active State
        // Remove previous active state and add new one
        const allLessonItems = document.querySelectorAll('#module-nav [data-lesson-index]');
        allLessonItems.forEach(item => {
            item.classList.remove('bg-indigo-50', 'font-semibold', 'text-indigo-700', 'border-l-4', 'border-amber-500');
            item.classList.add('text-gray-600', 'hover:bg-indigo-100'); // Ensure hover is maintained

            if (parseInt(item.dataset.lessonIndex) === currentLessonIndex) {
                item.classList.remove('text-gray-600', 'hover:bg-indigo-100');
                item.classList.add('bg-indigo-50', 'font-semibold', 'text-indigo-700', 'border-l-4', 'border-amber-500'); // Increased border for prominence
            }
        });

        // 5. Update Main Title and Subtitle
        lessonTitleEl.textContent = `${lesson.module}.${lesson.lesson} ${lesson.title}`;
        lessonSubtitleEl.textContent = lesson.subtitle.toUpperCase();

        // 6. Update Lesson Content
        lessonContentAreaEl.innerHTML = generateContentHTML(lesson);

        // 7. Update Navigation Buttons
        prevButton.disabled = currentLessonIndex === 0;
        nextButton.disabled = currentLessonIndex === courseData.length - 1;

        // Update Next button text
        if (currentLessonIndex === courseData.length - 1) {
             nextButton.querySelector('span').textContent = 'Course Complete!';
        } else {
            nextButton.querySelector('span').textContent = 'Next Lesson';
        }

        // Update Previous button text
        if (currentLessonIndex === 0) {
            prevButton.querySelector('span').textContent = 'Previous Lesson';
        } else {
            // Display the module and lesson number of the previous lesson
            prevButton.querySelector('span').textContent = `< ${courseData[currentLessonIndex - 1].module}.${courseData[currentLessonIndex - 1].lesson} - ${courseData[currentLessonIndex - 1].title.split(':')[0].split('(')[0].trim()}`;
        }
    }

    // --- Event Listeners and Initialization ---
    
    // 1. Sidebar Lesson Clicks
    function setupSidebarListeners() {
        const items = document.querySelectorAll('#module-nav [data-lesson-index]');
        items.forEach(item => {
            // Remove previous listeners to prevent duplicates
            item.removeEventListener('click', item._listener); 

            item._listener = (e) => {
                const index = parseInt(e.currentTarget.dataset.lessonIndex);
                updateLesson(index);
                // Scroll to the main content area on mobile, or keep in view on desktop
                const mainContent = document.querySelector('main');
                if (mainContent) {
                    mainContent.scrollIntoView({ behavior: 'smooth' });
                }
            };
            item.addEventListener('click', item._listener);
        });
    }

    // 2. Navigation Button Clicks
    prevButton.addEventListener('click', () => {
        if (currentLessonIndex > 0) {
            updateLesson(currentLessonIndex - 1);
            document.querySelector('main').scrollIntoView({ behavior: 'smooth' });
        }
    });

    nextButton.addEventListener('click', () => {
        if (currentLessonIndex < courseData.length - 1) {
            updateLesson(currentLessonIndex + 1);
            document.querySelector('main').scrollIntoView({ behavior: 'smooth' });
        }
    });
    
    // 3. Header Dropdown Toggles
    moduleSelectorBtn.addEventListener('click', () => toggleDropdown());
    
    // Close dropdown when clicking outside
    document.addEventListener('click', (event) => {
        if (!moduleSelectorBtn.contains(event.target) && !headerModuleDropdown.contains(event.target)) {
            toggleDropdown(false);
        }
    });

    // 4. Initial Load
    window.onload = function() {
        // Create Lucide icons
        lucide.createIcons();
        
        // Setup initial sidebar listeners (no DOM fixes needed as the hardcoded HTML is correct)
        setupSidebarListeners();
        
        // Generate the dropdown menu content
        generateDropdownLessons();

        // Load the very first lesson on page load (index 0)
        updateLesson(currentLessonIndex);
    };

</script>

