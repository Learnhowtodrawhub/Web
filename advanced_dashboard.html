<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Course: Foundational Drawing Curriculum</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        /* Custom font import for Inter */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7fafc; /* Light gray background */
        }
        /* Custom scrollbar for the horizontal nav */
        #header-module-nav-container::-webkit-scrollbar {
            height: 4px;
        }
        /* Scrollbar thumb color */
        #header-module-nav-container::-webkit-scrollbar-thumb {
            background-color: rgb(245 158 11); /* amber-500 */
            border-radius: 10px;
        }
        /* Class for the Module 1 consolidated content container */
        .module-1-content-section {
            padding: 3rem 0;
            border-bottom: 1px solid #e5e7eb; /* Light separator line */
        }
        .module-1-content-section:last-child {
            border-bottom: none;
        }
        /* Explicitly remove any outline/border for header lesson links on focus/active */
        .header-lesson-link:focus, 
        .header-lesson-link:active,
        .header-lesson-link.text-amber-500 { /* Target the active amber link specifically */
            outline: none !important;
            box-shadow: none !important;
            border: none !important;
            text-decoration: none !important;
        }
    </style>
</head>
<body class="text-gray-800 min-h-screen flex flex-col">

    <!-- Header & Navigation (Now contains the horizontal lesson navigation) -->
    <header class="bg-sky-900 shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3 flex justify-between items-center">
            <!-- Logo/Home Link -->
            <a href="#" class="flex items-center space-x-2 text-xl font-extrabold text-white tracking-tight flex-shrink-0">
                <img src="lhtdhublogo.jpg" alt="lhtdhub Logo" class="h-8 w-8 rounded-full shadow-md" onerror="this.onerror=null; this.src='https://placehold.co/32x32/sky500/ffffff?text=LTD';">
                <span class="hidden sm:inline">Serious Drawing Skills</span>
                <span class="inline sm:hidden">Drawing Course</span>
            </a>
            
            <!-- NEW: Module Lesson Navigation (Top Right) -->
            <div id="header-module-nav-container" class="flex items-center space-x-3 overflow-x-auto ml-4 py-1">
                <!-- Dynamic content rendered here by JavaScript -->
            </div>
        </div>
    </header>

    <!-- Main Content: Player and Modules -->
    <main class="flex-grow max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 lg:py-12">
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">

            <!-- Column 1: Module Navigation (Sidebar) -->
            <aside class="lg:col-span-1 bg-white p-6 rounded-2xl shadow-xl border border-gray-100 h-fit lg:sticky lg:top-[70px]">
                <h2 class="text-2xl font-extrabold text-sky-900 mb-4 border-b pb-2">Course Modules</h2>
                <!-- Modules will be populated by JavaScript here -->
                <nav class="space-y-4" id="course-modules">
                    <!-- Dynamic Content -->
                </nav>
            </aside>

            <!-- Column 2: Lesson Content Container -->
            <section class="lg:col-span-3">
                
                <div class="bg-white p-6 md:p-8 rounded-2xl shadow-2xl">
                    <h1 class="text-3xl sm:text-4xl font-extrabold text-sky-900 mb-2" id="lesson-title"></h1>
                    <p class="text-sky-800 font-bold uppercase tracking-widest mb-6" id="course-title">
                        Mastering Figure, Light, and Digital Art Production
                    </p>

                    <!-- Main content area to be populated by JS (can hold single lesson or consolidated module) -->
                    <div id="lesson-content-area" class="text-gray-700">
                        <!-- Dynamic content for the current lesson/module will be inserted here -->
                    </div>

                    <!-- Navigation Buttons -->
                    <div class="flex justify-between items-center mt-8 pt-6 border-t border-gray-200">
                        <button id="prev-button" onclick="navigateLesson('prev')" class="inline-flex items-center space-x-1 px-6 py-3 text-sky-900 font-bold rounded-xl border border-sky-900 hover:bg-sky-50 transition duration-300 shadow-md disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-left"><path d="m15 18-6-6 6-6"/></svg>
                            <span>Previous Lesson</span>
                        </button>
                        
                        <button id="mark-complete-button" onclick="markLessonCompleted()" class="flex items-center space-x-2 bg-sky-600 text-white font-extrabold px-6 py-3 rounded-xl hover:bg-sky-700 transition duration-300 shadow-lg disabled:opacity-50 disabled:cursor-not-allowed">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-check-circle"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><path d="m9 11 3 3L22 4"/></svg>
                            <span id="mark-text">Mark as Complete</span>
                        </button>

                        <button id="next-button" onclick="navigateLesson('next')" class="inline-flex items-center space-x-1 bg-amber-500 text-sky-900 font-extrabold px-6 py-3 rounded-xl hover:bg-amber-400 transition duration-300 shadow-lg disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                            <span>Next Lesson</span>
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right"><path d="m9 18 6-6-6-6"/></svg>
                        </button>
                    </div>

                </div>
            </section>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-sky-900 text-white py-8 mt-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <p class="text-sm mb-4">Â© 2025 Learn How to Draw Hub. All course content is for student use only.</p>
        </div>
    </footer>

</body>
<script>
    // Course Data Structure
    const courseData = [
        {
            id: 1,
            title: "1. Foundational Perspective: The Building Blocks",
            lessons: [
                {
                    id: '1.1',
                    title: "Horizon Line and Eye-Level",
                    videoId: "",
                    description: "Establish your fundamental understanding of 3D space on a 2D plane. Learn to define and consistently use the **Horizon Line (Eye-Level)** and the concept of **Orthogonal Lines** (lines receding in space) to control depth and scale in every drawing. We'll introduce the concept of the **Picture Plane**.",
                    actionItems: [
                        "Practice drawing straight lines and accurate geometric volumes (**cubes**, **cylinders**) freehand without rulers.",
                        "Draw 20 Horizon Lines and place a human head at eye-level, above, and below it, observing the change in plane visibility.",
                        "Execute 5 pages of hatching/cross-hatching exercises to improve **line weight** and control."
                    ],
                    completed: true 
                },
                {
                    id: '1.2',
                    title: "1-Point Perspective (Interiors and Focus)",
                    videoId: "",
                    description: "Deep dive into **1-Point Perspective**, where one face of the object is parallel to the viewer. This is ideal for interiors, hallways, tunnels, and creating a strong sense of focused depth. Learn to use the **Central Vanishing Point** for dramatic staging and utilize diagonals for space division.",
                    actionItems: [
                        "Draw a minimum of 10 cubes and prisms in 1-Point perspective, paying close attention to parallel lines.",
                        "Design and sketch a complex room interior (e.g., a bedroom or office) using only one Vanishing Point (VP).",
                        "Accurately divide a back wall plane into equal-sized grid squares to represent tiled flooring or windows."
                    ],
                    completed: false
                },
                {
                    id: '1.3',
                    title: "2-Point Perspective (Exteriors and Rotation)",
                    videoId: "",
                    description: "Master **2-Point Perspective**, essential for drawing buildings, furniture, and objects viewed at an angle. Learn how to place and manage two separate **Vanishing Points (VPs)** to create realistic rotation and complexity in exterior scenes. Understand the relationship between the two VPs on the **Horizon Line**.",
                    actionItems: [
                        "Draw 15 objects (boxes, cars, books) at various angles using 2-Point perspective.",
                        "Sketch a street corner scene with two intersecting buildings, ensuring vertical lines remain perpendicular to the ground.",
                        "Practice the **Measuring Point** technique to accurately place details like windows and doors on a long wall."
                    ],
                    completed: false
                },
                {
                    id: '1.4',
                    title: "3-Point Perspective (Scale and Drama)",
                    videoId: "",
                    description: "Advance to **3-Point Perspective**, which introduces a third vertical vanishing point to simulate extreme height or depth. This is crucial for dynamic scenes like looking up at a skyscraper (**Worm's Eye View**) or looking down from a cliff (**Bird's Eye View**). Focus on the dramatic effect of convergence.",
                    actionItems: [
                        "Draw a cube in 3-Point perspective looking up (Worm's Eye) and another looking down (Bird's Eye).",
                        "Design a simple sci-fi cityscape using 3-Point perspective to emphasize **extreme scale** and depth.",
                        "Practice drawing a figure standing on the ground plane in both the Worm's Eye and Bird's Eye setups."
                    ],
                    completed: false
                },
                {
                    id: '1.5',
                    title: "Curves, Inclines, and Reflections",
                    videoId: "",
                    description: "Tackle challenging perspective elements: drawing perfect **ellipses** (circles in perspective) for wheels, cups, and spheres; rendering **inclined planes** (ramps, roofs, stairs) using auxiliary vanishing points; and simulating **reflections** in glass and water using the mirror principle.",
                    actionItems: [
                        "Draw 10 cylinders at varying heights to practice **ellipse accuracy**âpaying attention to the curve of the ellipse opening.",
                        "Draw a staircase receding in 2-Point perspective using construction lines for the **inclined VP**.",
                        "Sketch a scene with a flat pool of water and accurately draw the reflection of a nearby object using the 'drop-and-measure' method."
                    ],
                    completed: false
                }
            ]
        },
        {
            id: 2,
            title: "2. Human and Figure Anatomy",
            lessons: [
                {
                    id: '2.1',
                    title: "Proportional Systems and Primary Masses",
                    videoId: "",
                    description: "Establish the fundamental structure of the figure. Learn the average **proportions** (7.5 to 8-head method) and simplify the skeletal structure into the three primary masses: the **cranium** (skull), **rib cage** (thoracic arch), and **pelvis** (hip box). Understanding these masses is key to movement.",
                    actionItems: [
                        "Practice the 8-head proportional system for both male and female figures.",
                        "Draw 10 wireframe figures emphasizing the size and relationship between the rib cage and pelvis as simple boxes.",
                        "Identify the major **skeletal landmark points** (e.g., collarbone, hip bone) on 5 simple figures."
                    ],
                    completed: false
                },
                {
                    id: '2.2',
                    title: "Gesture and Line of Action",
                    videoId: "",
                    description: "Focus on capturing **energy, rhythm, and movement** rather than details. Learn to use the **Line of Action** (the core spine curve), **C and S curves**, and the **kinetic chain** to generate dynamic, believable poses, avoiding stiff, static figures.",
                    actionItems: [
                        "Complete two 30-minute sessions of **10-second gesture drawings** (minimum 60 figures total).",
                        "Analyze and draw the Line of Action for 5 complex athletic poses (running, jumping).",
                        "Draw 10 simple figures focusing only on the tilt of the shoulders and hips (the cross-contour)."
                    ],
                    completed: false
                },
                {
                    id: '2.3',
                    title: "Torso Dynamics and Core Muscle Groups",
                    videoId: "",
                    description: "Deep dive into the complex structure of the torso. Study major muscle groups (**abdominals**, **obliques**, **latissimus dorsi**, **pectorals**) and how they attach and stretch. Crucially, learn the rules of **twist and bend** (compression vs. tension) in the core.",
                    actionItems: [
                        "Draw 10 torsos in twist and bend poses to understand how muscles stretch and compress.",
                        "Practice drawing the **core forms** (rib cage, pelvis) as separate, pivoting boxes.",
                        "Draw 5 complete figures focusing on the transition between the rib cage and the abdomen."
                    ],
                    completed: false
                },
                {
                    id: '2.4',
                    title: "Head Construction and Facial Features",
                    videoId: "",
                    description: "A dedicated lesson on the most expressive element. Master the **Loomis Method** or the **Asaro Head** concept to simplify the skull into planes. Learn the correct proportional placement of the eyes, nose, and mouth in **frontal, profile, and 3/4 views**.",
                    actionItems: [
                        "Draw 10 heads using the Loomis method in 3 different angles.",
                        "Focus on drawing the features: 5 pairs of eyes, 5 noses, and 5 mouths, ensuring they align to the head's **center line** and **brow line**.",
                        "Practice drawing the head's forms under different lighting conditions."
                    ],
                    completed: false
                },
                {
                    id: '2.5',
                    title: "Advanced Limbs: Hands and Feet",
                    videoId: "",
                    description: "The most challenging body parts require dedicated focus. Learn the box and wedge construction methods for **hands** to define the palm and finger groups. Study the basic three-part structure of the **foot** and its impact on ground stability.",
                    actionItems: [
                        "Draw 10 quick sketches of hands in different dynamic poses (**grasping**, **pointing**, **fist**).",
                        "Draw 5 examples of feet in various perspectives (side, front, 3/4 view) and imagine weight transfer.",
                        "Study and draw the form of the ankle and wrist bones, noting how they dictate the form of the joint."
                    ],
                    completed: false
                }
            ]
        },
        {
            id: 3,
            title: "3. Light, Composition, and Rendering Mastery",
            lessons: [
                {
                    id: '3.1',
                    title: "Advanced Balance, Weight, and Contrapposto",
                    videoId: "",
                    description: "Refine your understanding of the physics of a standing figure. Learn how to distribute **weight** (center of gravity and **plumb line** check) and utilize **Contrapposto** (the natural opposing tilt of hips and shoulders) to create natural, relaxed, and balanced poses in motion and rest.",
                    actionItems: [
                        "Draw 5 standing figures and identify the exact **center of gravity** and weight-bearing foot.",
                        "Sketch 3 figures in complex motion, ensuring their central axis/plumb line remains accurate to avoid instability.",
                        "Practice figure drawing focusing only on the subtle shifts created by **Contrapposto**."
                    ],
                    completed: false
                },
                {
                    id: '3.2',
                    title: "Form, Overlap, and Tangents for Depth",
                    videoId: "",
                    description: "Utilize the principles of **Foreshortening** (making forms jut out toward the viewer), **Overlap** (creating spatial depth by layering forms), and mastering **Tangent avoidance** (where edges touch and confuse depth) to make your drawings visually pop and feel three-dimensional.",
                    actionItems: [
                        "Draw a series of overlapping simple shapes to practice depth perception and avoid tangents.",
                        "Sketch a figure with emphasis on forcing the limbs to jut out toward the viewer using foreshortening.",
                        "Create a composition focusing on layering foreground, middle-ground, and background elements."
                    ],
                    completed: false
                },
                {
                    id: '3.3',
                    title: "Light, Shadow, and Value Hierarchy",
                    videoId: "",
                    description: "A comprehensive lesson on value. Understand the **light family** (highlight, mid-tone) and **shadow family** (**core shadow**, **reflected light**, **cast shadow**). Learn the terminology and how to use a controlled **value hierarchy** to direct the viewer's eye and define form.",
                    actionItems: [
                        "Draw three spheres and fully render them, correctly labeling the five main value zones (Highlight, Mid-tone, Core Shadow, Reflected Light, Cast Shadow).",
                        "Practice simplifying a complex scene into only **three major values** (light, medium, dark) to establish focus.",
                        "Analyze a photo and identify the **Occlusion Shadow** (darkest shadow where objects touch)."
                    ],
                    completed: false
                },
                {
                    id: '3.4',
                    title: "Principles of Composition and Staging",
                    videoId: "",
                    description: "Study how to effectively **stage** elements within your frame. Learn about fundamental rules like the **Rule of Thirds**, **Golden Ratio**, utilizing **leading lines** to guide the eye, and the power of **negative space** to simplify and frame a subject.",
                    actionItems: [
                        "Redraw a simple scene using the **Rule of Thirds** for focal placement.",
                        "Design 3 different thumbnail compositions for a single subject, using **leading lines** in each.",
                        "Identify areas of **negative space** in a complex reference image and use it to simplify the background."
                    ],
                    completed: false
                },
                {
                    id: '3.5',
                    title: "Material Rendering and Texturing",
                    videoId: "",
                    description: "Learn techniques to visually communicate different **materials** through specific value control, reflectivity, and texture simulation. This applies to rendering **polished metal** (sharp, high contrast), **glass** (transparency/refraction), **wood** (grain/texture), and **fabric** (soft folds).",
                    actionItems: [
                        "Render three spheres to look like polished metal, matte plastic, and rough stone, focusing on edge quality.",
                        "Practice drawing complex folds and wrinkles on draped fabric, distinguishing between **tubular folds** and **spiral folds**.",
                        "Create a small still life focusing on different materials (e.g., a glass bottle and a wooden box)."
                    ],
                    completed: false
                },
                {
                    id: '3.6',
                    title: "Visual Storytelling and Character Design",
                    videoId: "",
                    description: "Go beyond drawing technical shapes to imparting meaning. Introduces how form language (sharp vs. soft shapes), **silhouette**, and pose contribute to **character design** and narrative. Learn to use exaggeration and stylization effectively to tell a story with a single image.",
                    actionItems: [
                        "Draw a character design using only the **silhouette** to convey their personality (e.g., villain vs. hero).",
                        "Redesign a classic character, simplifying their design using three primary **geometric shapes** (triangle, square, circle).",
                        "Create a mini-comic panel where the background composition enhances the character's emotion."
                    ],
                    completed: false
                }
            ]
        },
        {
            id: 4,
            title: "4. Digital Workflow and Production",
            lessons: [
                {
                    id: '4.1',
                    title: "Digital Tool Fundamentals and Layers",
                    videoId: "",
                    description: "Master the essential concepts of digital art: setting up the digital canvas (**DPI and resolution**), understanding **layers** and layer grouping, and utilizing common **blending modes** (Multiply, Screen, Overlay) for fast value and color changes.",
                    actionItems: [
                        "Set up a document with a non-destructive workflow (sketch layer, line art layer, color fill layer).",
                        "Experiment with **blending modes** by painting a value layer and applying 'Multiply' to a color layer beneath it.",
                        "Customize 5 core brushes to control **size jitter**, **opacity**, and **flow**."
                    ],
                    completed: false
                },
                {
                    id: '4.2',
                    title: "Color Theory for Digital Painters",
                    videoId: "",
                    description: "Translate traditional color theory into the digital realm. Study the **color wheel**, common **color schemes** (**triadic**, **analogous**, **complementary**), and the relationship between **hue, saturation, and value (HSV)**. Learn basic **color grading** for mood setting.",
                    actionItems: [
                        "Create a monochromatic painting, manipulating only the value and saturation.",
                        "Choose a triadic color scheme and use it to paint a simple object.",
                        "Practice using the **Eyedropper Tool** to analyze and correct color shifts in reference photos."
                    ],
                    completed: false
                },
                {
                    id: '4.3',
                    title: "Rendering Digital Textures and Brushes",
                    videoId: "",
                    description: "Focus on efficiency. Learn techniques for quickly generating **custom brushes** from images, using textures to add quick detail (e.g., for skin, stone, metal), and applying ambient effects like **color dodge** for digital highlights.",
                    actionItems: [
                        "Create a simple custom texture brush (e.g., grass or rock) and apply it to a background.",
                        "Use the **clipping mask** function to apply a rough texture only within a specific shape.",
                        "Practice using soft light/overlay layers to add a subtle color filter over the entire canvas."
                    ],
                    completed: false
                },
                {
                    id: '4.4',
                    title: "Basic Environment and Prop Design",
                    videoId: "",
                    description: "Apply your perspective and lighting skills to world-building. Learn to use perspective grids to create believable **environments** (both interiors and landscapes) and design supporting **props** (weapons, tools, furniture) that fit the narrative and style of your character design.",
                    actionItems: [
                        "Sketch an environment thumbnail using a 2-Point grid, including a horizon line and scale reference.",
                        "Design 3 unique variations of a single prop (e.g., a chair or a sword) based on different cultural aesthetics.",
                        "Draw a background using only **atmospheric perspective** to create depth (lighter, desaturated colors in the distance)."
                    ],
                    completed: false
                },
                {
                    id: '4.5',
                    title: "Portfolio Preparation and Presentation",
                    videoId: "",
                    description: "The final step: presenting your work professionally. Learn tips for **curating** and selecting your best pieces, understanding the difference between **industry portfolios** (concept art, illustration), and basic tips for file naming, resolution, and watermarking.",
                    actionItems: [
                        "Critique your own work and select the 10 strongest pieces for a mock portfolio.",
                        "Redo 3 older pieces with your new knowledge of light and anatomy for inclusion in the final portfolio.",
                        "Research and outline the **submission requirements** for two different art studios or client types you are interested in."
                    ],
                    completed: false
                }
            ]
        }
    ];

    let currentLessonId = '1.1'; // Start with the new lesson 1.1

    // --- Utility Functions ---

    // Finds a lesson object by its ID (e.g., '1.1', '2.1')
    function getLesson(id) {
        for (const module of courseData) {
            const lesson = module.lessons.find(l => l.id === id);
            if (lesson) return lesson;
        }
        return null;
    }

    // Gets the index of the current lesson in the flattened list
    function getFlattenedIndex(id) {
        let allLessons = [];
        courseData.forEach(module => {
            allLessons.push(...module.lessons);
        });
        return allLessons.findIndex(l => l.id === id);
    }
    
    // Gets all lessons in a specific module
    function getModuleLessons(moduleId) {
        const module = courseData.find(m => m.id === moduleId);
        return module ? module.lessons : [];
    }

    // --- UI Rendering Functions ---

    // Renders the horizontal navigation bar for the current module in the header
    function renderModuleLessonNav() {
        const navContainer = document.getElementById('header-module-nav-container');
        if (!navContainer) return;

        // 1. Find the current module
        const currentModuleId = parseInt(currentLessonId.split('.')[0]);
        const currentModule = courseData.find(m => m.id === currentModuleId);

        if (!currentModule) {
            navContainer.innerHTML = '';
            return;
        }

        const navHtml = currentModule.lessons.map(lesson => {
            const isCurrent = lesson.id === currentLessonId;
            
            // Base classes for a clean text link. 
            const baseClasses = 'header-lesson-link px-3 py-1 flex-shrink-0 font-bold whitespace-nowrap transition duration-150 rounded-md text-sm cursor-pointer no-underline hover:no-underline focus:outline-none focus:ring-0'; 
            
            // Active link is distinguished only by text color (Amber), inactive is White.
            const activeColor = isCurrent 
                ? 'text-amber-500' // Active link text is Amber (Yellow)
                : 'text-white';   // Inactive links are white

            // Use the lesson ID and only the main title text
            const displayTitle = lesson.title.includes(':') ? lesson.title.split(':').pop().trim() : lesson.title;

            return `
                <a onclick="loadLesson('${lesson.id}')" 
                   class="${baseClasses} ${activeColor}">
                    ${lesson.id} ${displayTitle}
                </a>
            `;
        }).join('');

        navContainer.innerHTML = navHtml;
    }
    
    // Renders the entire sidebar navigation
    function renderModules() {
        const modulesContainer = document.getElementById('course-modules');
        modulesContainer.innerHTML = '';
        
        courseData.forEach(module => {
            const moduleEl = document.createElement('div');
            moduleEl.className = 'group pt-2';
            
            moduleEl.innerHTML = `
                <h3 class="flex items-center justify-between text-lg font-bold p-2 text-sky-800 cursor-pointer">
                    <span>${module.title}</span>
                </h3>
            `;
            
            const lessonList = document.createElement('ul');
            lessonList.className = 'ml-4 border-l pl-4 border-gray-200 text-gray-600 space-y-1 text-sm';

            module.lessons.forEach(lesson => {
                const isCurrent = lesson.id === currentLessonId;
                const isComplete = lesson.completed;

                let classes = 'p-2 rounded-lg transition duration-150 flex justify-between items-center';
                
                if (isCurrent) {
                    // This is the amber border on the LEFT in the sidebar. 
                    classes += ' bg-sky-50 font-semibold text-sky-700 border-l-2 border-amber-500'; 
                } else if (isComplete) {
                    classes += ' bg-green-50 text-green-700 hover:bg-green-100 cursor-pointer';
                } else {
                    classes += ' hover:bg-sky-100 cursor-pointer';
                }

                const checkIcon = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-check text-green-500"><path d="M20 6 9 17l-5-5"/></svg>`;
                
                const statusIcon = isComplete ? checkIcon : '';

                const listItem = document.createElement('li');
                listItem.className = classes;
                listItem.dataset.lessonId = lesson.id;
                
                listItem.onclick = () => loadLesson(lesson.id);

                listItem.innerHTML = `
                    <span>${lesson.id} ${lesson.title}</span>
                    ${statusIcon}
                `;
                
                lessonList.appendChild(listItem);
            });
            
            moduleEl.appendChild(lessonList);
            modulesContainer.appendChild(moduleEl);
        });
        
        lucide.createIcons(); // Re-render icons after DOM update
    }

    // Renders the content for a single lesson
    function renderLessonContent(lesson) {
        // Function to convert markdown bold **text** to HTML <strong>text</strong>
        const applyBolding = (text) => text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');

        // 1. Convert markdown bold **text** to HTML <strong>text</strong> for the description
        const processedDescription = applyBolding(lesson.description);

        // 2. Process all action items for markdown bolding
        const actionItemsHtml = lesson.actionItems.map(item => {
            // Apply bolding replacement to the whole item string
            const processedItem = applyBolding(item);
            
            // Re-apply the existing split and wrap logic on the processed string
            const parts = processedItem.split(':');
            const primaryPart = parts[0];
            const secondaryPart = parts.slice(1).join(':');

            return `<li><span class="font-semibold">${primaryPart}</span>${secondaryPart ? ': ' + secondaryPart : ''}</li>`;
        }).join('');

        return `
            <div class="prose max-w-none text-gray-700">
                <h2 class="text-2xl font-bold text-sky-800 mb-3">${lesson.title.includes(':') ? lesson.title.split(':').pop().trim() : lesson.title}</h2>
                <p id="lesson-description-${lesson.id}">${processedDescription}</p>
                
                <h3 class="text-xl font-bold text-sky-700 mt-6">Action Items for ${lesson.id}:</h3>
                <ul class="list-disc list-inside space-y-1 ml-4">
                    ${actionItemsHtml}
                </ul>
            </div>
        `;
    }

    // Loads the main lesson content
    function loadLesson(id) {
        const lesson = getLesson(id);
        if (!lesson) return;

        currentLessonId = id;
        const moduleId = parseInt(id.split('.')[0]);
        const contentArea = document.getElementById('lesson-content-area');
        const lessonTitleHeader = document.getElementById('lesson-title');
        
        // --- Logic for Consolidation (Module 1 is consolidated) ---
        if (moduleId === 1) {
            // Display Module Title and load all content for Module 1
            const module = courseData.find(m => m.id === 1);
            lessonTitleHeader.textContent = module.title;
            
            let consolidatedHtml = module.lessons.map(l => {
                return `<div id="lesson-${l.id}" class="module-1-content-section">
                            ${renderLessonContent(l)}
                        </div>`;
            }).join('');
            
            contentArea.innerHTML = consolidatedHtml;
            
            // Scroll to the currently active lesson within the consolidated view
            const activeLessonEl = document.getElementById(`lesson-${id}`);
            if (activeLessonEl) {
                activeLessonEl.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }

        } else {
            // Standard single lesson display for Modules 2, 3, and 4
            lessonTitleHeader.textContent = `${lesson.id} ${lesson.title}`;
            contentArea.innerHTML = renderLessonContent(lesson);
        }

        // Update buttons and state
        updateNavigationButtons();
        updateMarkCompleteButton(lesson);
        renderModules(); // Re-render sidebar to update active state
        renderModuleLessonNav(); // Re-render horizontal navigation to update active state
    }

    // Handles marking the current lesson as completed
    function markLessonCompleted() {
        const lesson = getLesson(currentLessonId);
        if (lesson && !lesson.completed) {
            lesson.completed = true;
            // Navigate to the next lesson only if the current one was successfully marked complete
            navigateLesson('next'); 
        }
        renderModules();
    }

    // Handles the Previous and Next buttons logic
    function updateNavigationButtons() {
        const allLessons = courseData.flatMap(m => m.lessons);
        const currentIndex = getFlattenedIndex(currentLessonId);
        const prevButton = document.getElementById('prev-button');
        const nextButton = document.getElementById('next-button');

        // Previous Button Logic
        prevButton.disabled = currentIndex <= 0;

        // Next Button Logic
        if (currentIndex < allLessons.length - 1) {
            const currentLesson = getLesson(currentLessonId);
            // Next lesson is only clickable if the current lesson is complete
            nextButton.disabled = !currentLesson.completed;
        } else {
            nextButton.disabled = true;
        }
    }
    
    // Updates the Mark Complete button text/state
    function updateMarkCompleteButton(lesson) {
        const markButton = document.getElementById('mark-complete-button');
        const markText = document.getElementById('mark-text');
        
        if (lesson.completed) {
            markButton.disabled = true;
            markText.textContent = 'Lesson Completed!';
            markButton.className = 'flex items-center space-x-2 bg-green-600 text-white font-extrabold px-6 py-3 rounded-xl shadow-lg disabled:opacity-50 disabled:cursor-not-allowed';
        } else {
            markButton.disabled = false;
            markText.textContent = 'Mark as Complete';
            // Mark button is bg-sky-600/700
            markButton.className = 'flex items-center space-x-2 bg-sky-600 text-white font-extrabold px-6 py-3 rounded-xl hover:bg-sky-700 transition duration-300 shadow-lg disabled:opacity-50 disabled:cursor-not-allowed';
        }
    }

    // Logic for navigating to the previous/next lesson
    function navigateLesson(direction) {
        const allLessons = courseData.flatMap(m => m.lessons);
        const currentIndex = getFlattenedIndex(currentLessonId);
        let targetIndex;

        if (direction === 'next') {
            targetIndex = currentIndex + 1;
        } else if (direction === 'prev') {
            targetIndex = currentIndex - 1;
        } else {
            return;
        }

        if (targetIndex >= 0 && targetIndex < allLessons.length) {
            const targetLessonId = allLessons[targetIndex].id;
            loadLesson(targetLessonId);
        }
    }

    // --- Initialization ---
    window.onload = function () {
        // Update the main course title text
        document.getElementById('course-title').textContent = 'Mastering Figure, Light, and Digital Art Production'; 
        
        lucide.createIcons();
        loadLesson(currentLessonId); // Load the initial lesson (1.1) on page load
    };
</script>
